@model Coinco.SMS.Website.Models.SerivceOrderPartLine
@using Telerik.Web.Mvc.UI
@using Telerik.Web.Mvc
@{
    ViewBag.Title = "Order Process";
}
<style type="text/css">
    div
    {
        font-weight: normal;
        font-style: normal;
        font-size: 1.02em;
    }
    .ui-widget
    {
        font-family: inherit;
        font-size: inherit;
    }
</style>
<div class="pageCointainer" id="pageCointainer">
    <div id="serviceProcessDiv" class="serviceProcessDiv" >
        <div class="leftcolumn">
            @Html.Label("Service Order:", new { @class = "labelHeaderView", id = "serviceOrderLabel" })
            @Html.Label(TempData["ServiceOrderId"].ToString(), new { @class = "labelViewSO", id = "serviceOrderViewlabel" })
            <br />
            @Html.Label("Serial Number:", new { @class = "labelHeaderView", id = "serialNumberLabel" })
            @{Html.Telerik().ComboBox().Name("slNumberDropDownList")
            .BindTo((SelectList)ViewData["WorkSerialNumberList"])
            .ClientEvents(e => e.OnChange("onserialNumberDropDownChange"))
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)
            .Render();
            }
               <span class="mandatory">*</span>
            <br />
        </div>
        <div id="partNumberView">
            @{Html.RenderPartial("PartDetailsView", Model.ServiceOrderLine);}
        </div>
    </div>
    <div class="addLinesDiv" id="addLinesDiv" >
        <div class="addLineleftcolumn">
            <div class="header1">
                Add Lines</div>
            @Html.Label("Transaction Type:", new { @class = "labelHeaderSPView", id = "transactionHeadLabel" })  
            
            @{Html.Telerik().ComboBox().Name("transactionTypeDropDownList")
            .DataBinding(binding => binding.Ajax().Select("_GetTransactionTypes", "WorkOrder"))
             .SelectedIndex(0)
            .ClientEvents(e => e.OnChange("ontransactionHide"))
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .CascadeTo("specialtyCodeDropDownList")
            .Render();
            }
               <span class="mandatory">*</span>
            <br />
            @Html.Label("Description:", new { @class = "labelHeaderSPView", id = "descriptionHeadLabel" })  
            @Html.TextAreaFor(x => x.Description, new { id = "descriptionText" })
            <br />
           
             @Html.Label("Failure Code:", new { @class = "labelHeaderSPView", id = "failureCodeeHeadLabel" }) 
            @{Html.Telerik().ComboBox().Name("failureCodeDropDownList")
            .BindTo((SelectList)ViewData["FailureCodeList"])
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)

            .Render();
            }
            <br />
            @Html.Label("Specialty Code:", new { @class = "labelHeaderSPView", id = "specialtyCodeHeadLabel" })  
            @{Html.Telerik().ComboBox().Name("specialtyCodeDropDownList")
            .DataBinding(binding => binding.Ajax().Select("_GetDropDownListSpecialtyCode", "WorkOrder"))
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)
            .ClientEvents(events => events.OnChange("onSpecialityCodeChange"))
            //.CascadeTo("techniacianDropDownList")
            .Render();
            }
               <span class="mandatory">*</span>
            @Html.Label("LineProperty:", new { @class = "labelHeaderSPView", id = "linePropertyHeadLabel" })  
            @{Html.Telerik().ComboBox().Name("LinePropertyDropDownList")
            .BindTo((SelectList)ViewData["LinePropertyList"])
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)
            .Render();
            }
               <span class="mandatory">*</span>
            <br />
        </div>
        <div class="addLinecentercolumn">
            @Html.Label("Quantity:", new { @class = "labelHeaderSPView", id = "quantityHeadLabel" })  
            @Html.TextBoxFor(x => x.Quantity, new { @class = "textBoxPropertiesSP", id = "quantityText" })<br />
           @Html.Label("Technician:", new { @class = "labelHeaderView", id = "techniacianHeadLabel" }) 
            @{Html.Telerik().ComboBox().Name("techniacianDropDownList")
            //.BindTo((SelectList)ViewData["ServiceTechnicianList"])
            .DataBinding(binding => binding.Ajax().Select("_GetDropDownListTechnicianSpecialtyCode", "WorkOrder"))
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)
         
            .Render();
            }
            <br />
           @Html.Label("Service Comments:", new { @class = "labelHeaderView", id = "commentsHeadLabel" }) 
            @Html.TextAreaFor(x => x.ServiceComments, new { id = "commentsText" })
            <br />
            @Html.TextBoxFor(x => x.UniqueId, new { @class = "singleTextBox", id = "uniqueText", @type = "hidden" })<br />
        </div>
        <div class="addLineRightcolumn" id="addLineRightcolumn">
            <div class="topDimensioncolumn">
               <div class="header1">
                    Storage Dimension</div>
            @Html.Label("Item Number:", new { @class = "labelHeaderSPView", id = "itemNumberHeadLabel" }) 
            @{Html.Telerik().ComboBox().Name("itemNumberDropDownList")
            .BindTo((SelectList)ViewData["PartNumberList"])
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)
               .ClientEvents(events => events.OnChange("onItemNumberSiteChange"))

            .Render();
                }
                <span class="mandatory">*</span>
             @Html.Label("Site:", new { @class = "labelHeaderSPView", id = "siteHeadLabel" })   
                @{Html.Telerik().ComboBox().Name("siteComboBox")
            .BindTo((SelectList)ViewData["siteList"])
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)

            .Render();
                }
                   <span class="mandatory">*</span>
                @*@Html.DropDownListFor(x => x.Site.SiteID, new SelectList(""), "<--Select One-->", new { @class = "dropDownPropertiesSP", id = "LinePropertyDropDownList" })*@
             @Html.Label("Warehouse:", new { @class = "labelHeaderSPView", id = "wareHouseHeadLabel" })   
                @{Html.Telerik().ComboBox().Name("wareHouseDropDownList")
            .DataBinding(binding => binding.Ajax().Select("_GetDropDownWareHouse", "WorkOrder"))
            .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)
            .ClientEvents(events => events.OnChange("onwareHouseChange"))
            .Render();
                }
             @Html.Label("Location:", new { @class = "labelHeaderSPView", id = "locationHeadLabel" })   
                @{Html.Telerik().ComboBox().Name("locationDropDownList")
             .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)
             .ClientEvents(events => events.OnChange("onlocationChange"))
            .Render();
                }
            </div>
            <div class="centerDimensioncolumn">
               <div class="header1">
               Tracking Dimension</div>
               @Html.Label("Serial Number:", new { @class = "labelHeaderSPView", id = "serialNoHeadLabel" })   
                @{Html.Telerik().ComboBox().Name("trackingSerialNoDropDownList")
             .Placeholder("-- Select --")
            .HtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .DropDownHtmlAttributes(new { @class = "dropDownPropertiesSP" })
            .SelectedIndex(0)

            .Render();
                }
            </div>
        </div>
    </div>
    <div id="SubmitResult" class="submitResultServiceOrderProcess">
        <button class="t-button" type="button" id="Add" value="Add">
            Add</button>
        <button class="t-button" type="button" id="Update" value="Update">
            Update</button>
        <button class="t-button" type="button" id="Clear" value="Clear">
            Clear</button>
    </div>
    <div class="partLinesDiv" id="ServicepartLines">
        @{Html.RenderPartial("ServiceOrderPartLinesView");}
    </div>
    <div id="AddressDiv">
        @{Html.RenderPartial("AddressView", Model.ServiceOrders);}
    </div>
</div>
<script type="text/javascript">


    function onserialNumberDropDownChange(e) {

        if (e != null) {
            var serialNumber = e.currentTarget.value;
            jQuery.ajax({
                url: "/WorkOrder/GetServiceOrderLineBySerialNumberOrderProcess",
                type: 'GET',
                data: { serialNumber: serialNumber },
                success: function (result) {
                    jQuery('#partNumberView').html(result);
                },
                error: function (result) {
                    alert(result.responseText);
                }

            });


            return false;

        }
    }



    function ontransactionHide(e) {

        var transactionType = e.currentTarget.value;
        if (transactionType == "1") {
            $('#addLineRightcolumn').hide();
        }
        else if (transactionType == "2") {
            $('#addLineRightcolumn').hide();
        }
        else if (transactionType == "4") {
            $('#addLineRightcolumn').hide();
        }
        else if (transactionType == "3") {
            $('#addLineRightcolumn').show();
        }
    }


    jQuery('#Add').click(function () {
    
        var serviceOrderNo = $('#serviceOrderViewlabel')[0].innerHTML;
    
        var transactionType = $('#transactionTypeDropDownList').val();
        var technicinanNo = $('#techniacianDropDownList').val();
        var quantity = $('#quantityText').val();
        var specialityCode = $('#specialtyCodeDropDownList').val();
        var failureCode = $('#failureCodeDropDownList').val();
        var lineProperty = $('#LinePropertyDropDownList').val();
        var description = $('#descriptionText').val();
        var serviceComments = $('#commentsText').val();
        var itemNumber = $('#itemNumberDropDownList').val();
        var site = $('#siteComboBox').val();
        var wareHouse = $('#wareHouseDropDownList').val();
        var locationId = $('#locationDropDownList').val();
        var transSerialCodeNo = $('#trackingSerialNoDropDownList').val();
        var serviceOrderRelation = $('#slNumberDropDownList').val();

        if (($.trim(serviceOrderRelation) == '') || (serviceOrderRelation == null) || (serviceOrderRelation == '--Select--')) {
            alert('Please select the Serial Number.');
           // $('#slNumberDropDownList').addClass("input-validation-error");
            $('#slNumberDropDownList').focus();
            return;
        }

        if (($.trim(transactionType) == '') || (transactionType == null) || (transactionType == '--Select--')) {
            alert('Please select the Transaction Type.');
            //$('#transactionTypeDropDownList').addClass("input-validation-error");
            $('#transactionTypeDropDownList').focus();
            return;
        }

        if (($.trim(specialityCode) == '') || (specialityCode == null) || (specialityCode == '--Select--')) {
            alert('Please select the Speciality Code.');
            //$('#specialtyCodeDropDownList').addClass("input-validation-error");
            $('#specialtyCodeDropDownList').focus();
            return;
        }


        if (($.trim(lineProperty) == '') || (lineProperty == null) || (lineProperty == '--Select--')) {
            alert('Please select the Line property.');
            //$('#LinePropertyDropDownList').addClass("input-validation-error");
            $('#LinePropertyDropDownList').focus();
            return;
        }

        if (($.trim(itemNumber) == '') || (itemNumber == null) || (itemNumber == '--Select--')) {
            alert('Please select the Item Number.');
            //$('#itemNumberDropDownList').addClass("input-validation-error");
            $('#itemNumberDropDownList').focus();
            return;
        }

        if (($.trim(site) == '') || (site == null) || (site == '--Select--')) {
            alert('Please select the Site.');
            //$('#siteComboBox').addClass("input-validation-error");
            $('#siteComboBox').focus();
            return;
        }


        jQuery.ajax({
            url: "/WorkOrder/CreateServiceOrderPartLines",
            type: 'POST',

            data: { serviceOrderNo: serviceOrderNo, transactionType: transactionType, technicinanNo: technicinanNo, quantity: quantity, specialityCode: specialityCode, failureCode: failureCode, lineProperty: lineProperty, serviceOrderRelation: serviceOrderRelation, description: description, serviceComments: serviceComments, itemNumber: itemNumber, site: site, wareHouse: wareHouse, transSerialCodeNo: transSerialCodeNo, locationId: locationId },
            success: function (result) {
                jQuery('#ServicepartLines').html(result);

                alert('Service Order Part Lines Created Successfully');
                $('#transactionTypeDropDownList').data('tComboBox').value('--Select--');
                $('#quantityText').val('');
                $('#techniacianDropDownList').data('tComboBox').value('--Select--');
                $('#specialtyCodeDropDownList').data('tComboBox').value('--Select--');
                $('#failureCodeDropDownList').data('tComboBox').value('--Select--');
                $('#LinePropertyDropDownList').data('tComboBox').value('--Select--');
                $('#itemNumberDropDownList').data('tComboBox').value('--Select--');
                $('#wareHouseDropDownList').data('tComboBox').value('--Select--');
                $('#locationDropDownList').data('tComboBox').value('--Select--');
                $('#trackingSerialNoDropDownList').data('tComboBox').value('--Select--');
                $('#descriptionText').val('');
                $('#commentsText').val('');
            },
            error: function (result) {
                alert('An error occured while creating the service order part lines. Please check the inputs and try again');
            }

        });
        return false;
    });


   

    jQuery('#Update').click(function () {

        var serviceOrderNo = $('#serviceOrderViewlabel')[0].innerHTML;
        var transactionType = $('#transactionTypeDropDownList').val();
        var technicinanNo = $('#techniacianDropDownList').val();
        var quantity = $('#quantityText').val();
        var specialityCode = $('#specialtyCodeDropDownList').val();
        var failureCode = $('#failureCodeDropDownList').val();
        var lineProperty = $('#LinePropertyDropDownList').val();
        var description = $('#descriptionText').val();
        var serviceComments = $('#commentsText').val();
        var itemNumber = $('#itemNumberDropDownList').val();
        var site = $('#siteComboBox').val();
        var wareHouse = $('#wareHouseDropDownList').val();
        var locationId = $('#locationDropDownList').val();
        var transSerialCodeNo = $('#trackingSerialNoDropDownList').val();
        var serviceOrderRelation = $('#slNumberDropDownList').val();
        var uniqueId = $('#uniqueText').val();
        jQuery.ajax({
            url: "/WorkOrder/UpdateServiceOrderPartLines",
            type: 'POST',

            data: { uniqueId: uniqueId, serviceOrderNo: serviceOrderNo, transactionType: transactionType, technicinanNo: technicinanNo, quantity: quantity, specialityCode: specialityCode, failureCode: failureCode, lineProperty: lineProperty, serviceOrderRelation: serviceOrderRelation, description: description, serviceComments: serviceComments, itemNumber: itemNumber, site: site, wareHouse: wareHouse, transSerialCodeNo: transSerialCodeNo, locationId: locationId },
            success: function (result) {
                jQuery('#ServicepartLines').html(result);

                alert('Service Order Part Lines Updated Successfully');
                $('#transactionTypeDropDownList').data('tComboBox').value('--Select--');
                $('#quantityText').val('');
                $('#techniacianDropDownList').data('tComboBox').value('--Select--');
                $('#specialtyCodeDropDownList').data('tComboBox').value('--Select--');
                $('#failureCodeDropDownList').data('tComboBox').value('--Select--');
                $('#LinePropertyDropDownList').data('tComboBox').value('--Select--');
                $('#itemNumberDropDownList').data('tComboBox').value('--Select--');
                $('#wareHouseDropDownList').data('tComboBox').value('--Select--');
                $('#locationDropDownList').data('tComboBox').value('--Select--');
                $('#trackingSerialNoDropDownList').data('tComboBox').value('--Select--');
                $('#descriptionText').val('');
                $('#commentsText').val('');
            },
            error: function (result) {
                alert(result.responseText);
            }

        });
        return false;
    });


    jQuery('#Clear').click(function () {
        $('#transactionTypeDropDownList').data('tComboBox').value('--Select--');
        $('#quantityText').val('');
        $('#techniacianDropDownList').data('tComboBox').value('--Select--');
        $('#specialtyCodeDropDownList').data('tComboBox').value('--Select--');
        $('#failureCodeDropDownList').data('tComboBox').value('--Select--');
        $('#LinePropertyDropDownList').data('tComboBox').value('--Select--');
        $('#itemNumberDropDownList').data('tComboBox').value('--Select--');
        $('#wareHouseDropDownList').data('tComboBox').value('--Select--');
        $('#locationDropDownList').data('tComboBox').value('--Select--');
        $('#trackingSerialNoDropDownList').data('tComboBox').value('--Select--');
        $('#descriptionText').val('');
        $('#commentsText').val('');

    });

    function onItemNumberSiteChange(e) {


        var SelectedSiteId = $('#siteComboBox').val();
        var SelectedItemNumber = $('#itemNumberDropDownList').val();
        var getwareHouse = $('#wareHouseDropDownList').data('tComboBox');
        getwareHouse.loader.showBusy();

        jQuery.ajax({
            url: "/WorkOrder/_GetDropDownWareHouse",
            type: 'GET',
            data: { partNumberDropDownList: SelectedItemNumber, siteComboBox: SelectedSiteId },
            success: function (result) {
                getwareHouse.dataBind(result);
                getwareHouse.loader.hideBusy();
                getwareHouse.select(0);

            }


        });


        return false;

    }


    function onSpecialityCodeChange(e) {


        var SelectedtransactionId = $('#transactionTypeDropDownList').val();
        var SelectedSpecialityCode = $('#specialtyCodeDropDownList').val();
        var gettechniacian = $('#techniacianDropDownList').data('tComboBox');
        gettechniacian.loader.showBusy();

        jQuery.ajax({
            url: "/WorkOrder/_GetDropDownListTechnicianSpecialtyCode",
            type: 'GET',
            data: { transactionTypeDropDownList: SelectedtransactionId, specialtyCodeDropDownList: SelectedSpecialityCode },
            success: function (result) {
                gettechniacian.dataBind(result);
                gettechniacian.loader.hideBusy();
                gettechniacian.select(0);

            }


        });


        return false;

    }


    function onwareHouseChange(e) {

        var SelectedSiteId = $('#siteComboBox').val();
        var SelectedItemNumber = $('#itemNumberDropDownList').val();
        var SelectedwarehouseId = $('#wareHouseDropDownList').val();
        var getLocation = $('#locationDropDownList').data('tComboBox');
        getLocation.loader.showBusy();
        jQuery.ajax({
            url: "/WorkOrder/_GetLocationList",
            type: 'GET',
            data: { partNumberDropDownList: SelectedItemNumber, siteComboBox: SelectedSiteId, wareHouseDropDownList: SelectedwarehouseId },
            success: function (result) {

                getLocation.dataBind(result);
                getLocation.loader.hideBusy();
                getLocation.select(0);
            }


        });


        return false;

    }

    function onlocationChange(e) {


        var SelectedSiteId = $('#siteComboBox').val();
        var SelectedItemNumber = $('#itemNumberDropDownList').val();
        var SelectedwarehouseId = $('#wareHouseDropDownList').val();
        var SelectedlocationId = $('#locationDropDownList').val();
        var gettrackingSerialNo = $('#trackingSerialNoDropDownList').data('tComboBox');
        gettrackingSerialNo.loader.showBusy();
        jQuery.ajax({
            url: "/WorkOrder/_GetTransactionSerialNumberList",
            type: 'GET',
            data: { partNumberDropDownList: SelectedItemNumber, siteComboBox: SelectedSiteId, wareHouseDropDownList: SelectedwarehouseId, locationDropDownList: SelectedlocationId },
            success: function (result) {

                gettrackingSerialNo.dataBind(result);
                gettrackingSerialNo.loader.hideBusy();
                gettrackingSerialNo.select(0);
            }


        });


        return false;

    }
  
  

</script>
