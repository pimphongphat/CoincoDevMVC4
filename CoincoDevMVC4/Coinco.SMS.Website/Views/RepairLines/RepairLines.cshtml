@model Coinco.SMS.Website.Models.RepairType
@using Telerik.Web.Mvc.UI
@using Telerik.Web.Mvc
@{
    ViewBag.Title = "RepairLines";
}

<div class="pageCointainerRL">
    <div class="addLinesDivRL">
     <div class="addLineleftcolumnRL">
     <h6>Identification</h6>
     <br />
        @Html.Label("Service Order:", new {@class = "labelHeaderView", id = "serviceOrderLabel" })
        @Html.Label(TempData["ServiceOrderId"].ToString(), new { @class = "labelViewSO", id = "serviceOrderNo" })
         <br />
         <label> Serial Number:</label>
               @{Html.Telerik().ComboBox().Name("serialNumberList")
                     .BindTo((SelectList)ViewData["SerialNumberList"])
                     .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .ClientEvents(e => e.OnChange("onSerialNumberChange"))
                 .SelectedIndex(0)
                 .Render();
                }
                <span class="mandatory">*</span>
            <br />
          
            <div id = "partNumber" >
                 @{Html.RenderPartial("PartNumber", Model.ServiceOrderLine);}
            </div>
         <br />
     </div>
     <div class="addLinecentercolumnRL">
      <h6>Symptom</h6>
      <br />
            <label>Condition:</label>
                  @{Html.Telerik().ComboBox().Name("conditionList")
                        .BindTo((SelectList)ViewData["Condition"])
                        .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
            <label>Symptom Area:</label>
                 @{Html.Telerik().ComboBox().Name("symptomAreaList")
                       .BindTo((SelectList)ViewData["SymptomArea"])
                       .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .CascadeTo("symptomCodeList")
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
            <label>Symptom Code:</label>
             @{Html.Telerik().ComboBox().Name("symptomCodeList")
                       .DataBinding(binding => binding.Ajax().Select("_GetDropDownSymptomCode", "RepairLines"))
                       .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
     </div>
     <div class="addLineRightcolumnRL">
     <h6>Execution</h6>
     <br />
            <label>Repair Stage:</label>
               @{Html.Telerik().ComboBox().Name("repairStageList")
                     .BindTo((SelectList)ViewData["RepairStage"])
                     .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
       
            <label>Technician:</label>
               @{Html.Telerik().ComboBox().Name("technicianList")
                     .BindTo((SelectList)ViewData["ServiceTechnicianList"])
                     .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
             
            <label>Comments:</label>
               @Html.TextAreaFor(x => x.Comments, new { id = "commentsTextBox" }) 
            <br />
     </div>
    </div>

    <div class="addLinesDivRL1">
     <div class="addLineleftcolumnRL">
     <br />
     <h6>Description</h6>
     <br />
        <label>Description:</label>
                @Html.TextAreaFor(x => x.Description, new {id = "descriptionTextBox" })
         <br />
         @Html.TextBoxFor(x => x.UniqueId, new { @class = "singleTextBox" , id = "uniqueText", @type="hidden" })
     </div>
     <div class="addLinecentercolumnRL">
     <br />
      <h6>Diagnosis</h6>
      <br />
            <label>Diagnosis Area:</label>
                  @{Html.Telerik().ComboBox().Name("diagnosisAreaList")
                       .BindTo((SelectList)ViewData["DiagnosisArea"])
                       .Placeholder("--Select--") 
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .CascadeTo("diagnosisCodeList")
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
            <label>Diagnosis Code:</label>
                 @{Html.Telerik().ComboBox().Name("diagnosisCodeList")
                       .DataBinding(binding => binding.Ajax().Select("_GetDropDownDiagnosisCode", "RepairLines"))
                       .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
            <label>Resolution:</label>
               @{Html.Telerik().ComboBox().Name("resolutionList")
                     .BindTo((SelectList)ViewData["Resolution"])
                     .Placeholder("--Select--")
                 .HtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri; width=50px;" })
                 .DropDownHtmlAttributes(new { style = "font-size: 8pt; font-family: Calibri;" })
                 .SelectedIndex(0)
                 .Render();
                    }
            <br />
     </div>
    </div>
  <br />
  <br />
  <br />
  <br />
  <br />

    <div id="SubmitResult" class="centercolumnSubmitRL">
        <button class="t-button" type="button" id="submit" value="submit" disabled="true">Add</button>
        @*<button class="t-button" type="button" id="Update" value="Update"">Update</button>*@
        <button class="t-button" type="button" id="Clear" value="Clear"">Clear</button>
    </div>
   <div id ="divRepairLinesGrid" class="addLinesDivGrid">

    @{Html.RenderPartial("RepairLineDetails");}

  </div> 

</div>
<script type="text/javascript">


    function onSerialNumberChange(e) {
        if (e != null) {
            var serialNumber = e.currentTarget.value;
            if (serialNumber == "") 
            {
                $('#submit').attr('disabled', true);
            }
            else 
            {
                $('#submit').attr('disabled', false);
            }

            jQuery.ajax({
                url: "/RepairLines/getPartNumber",
                type: 'GET',
                data: { serialNumber: serialNumber },
                success: function (result) {
                    jQuery('#partNumber').html(result);
                },
                error: function (result) {
                    alert(result.responseText);
                }

            });


            return false;
        }
    }

    jQuery('#submit').click(function () {
    $('#submit').attr('disabled', true);

        var serviceOrderNo = $('#serviceOrderNo')[0].innerHTML;
        var serialNumberList = $("#serialNumberList").val();
        var conditionId = $('#conditionList').val();
        var symptomAreaId = $('#symptomAreaList').val();
        var symptomCodeId = $('#symptomCodeList').val();
        var diagnosisAreaId = $('#diagnosisAreaList').val();
        var diagnosisCodeId = $('#diagnosisCodeList').val();
        var resolutionId = $('#resolutionList').val();
        var repairStageId = $('#repairStageList').val();
        var technicianNo = $('#technicianList').val();
        var description = $('#descriptionTextBox').val();
        var serviceComments = $('#commentsTextBox').val();
        var uniqueId = $('#uniqueText').val();
       
        if (uniqueId == "") {
            jQuery.ajax({
                url: "/RepairLines/CreateRepairLineItems",
                type: 'POST',

                data: {
                    serviceOrderNo: serviceOrderNo,
                    serialNumberList: serialNumberList,
                    conditionId: conditionId,
                    symptomAreaId: symptomAreaId,
                    symptomCodeId: symptomCodeId,
                    diagnosisAreaId: diagnosisAreaId,
                    diagnosisCodeId: diagnosisCodeId,
                    resolutionId: resolutionId,
                    repairStageId: repairStageId,
                    technicianNo: technicianNo,
                    description: description,
                    serviceComments: serviceComments
                },
                success: function (result) {
                    jQuery('#divRepairLinesGrid').html(result);
                    alert('Repair Line Created Successfully');
                    //                    $('#serialNumberList').data("tComboBox").value("--Select--");
                    //                    $('#lblPartNumber').val('');
                    $('#conditionList').data("tComboBox").value("--Select--");
                    $('#symptomAreaList').data("tComboBox").value("--Select--");
                    $('#symptomCodeList').data("tComboBox").value("--Select--");
                    $('#diagnosisAreaList').data("tComboBox").value("--Select--");
                    $('#diagnosisCodeList').data("tComboBox").value("--Select--");
                    $('#resolutionList').data("tComboBox").value("--Select--");
                    $('#repairStageList').data("tComboBox").value("--Select--");
                    $('#technicianList').data("tComboBox").value("--Select--");
                    $('#descriptionTextBox').val('');
                    $('#commentsTextBox').val('');
                    $('#submit').attr('disabled', false);
                },
                error: function (result) {
                    alert(result.responseText);
                }

            });
        }
        else {
            jQuery.ajax({
                url: "/RepairLines/UpdateRepairLineItems",
                type: 'POST',

                data: {
                    uniqueId: uniqueId,
                    serviceOrderNo: serviceOrderNo,
                    serialNumberList: serialNumberList,
                    conditionId: conditionId,
                    symptomAreaId: symptomAreaId,
                    symptomCodeId: symptomCodeId,
                    diagnosisAreaId: diagnosisAreaId,
                    diagnosisCodeId: diagnosisCodeId,
                    resolutionId: resolutionId,
                    repairStageId: repairStageId,
                    technicianNo: technicianNo,
                    description: description,
                    serviceComments: serviceComments
                },
                success: function (result) {
                    jQuery('#divRepairLinesGrid').html(result);

                    alert('Repair Line Updated Successfully');
                    //                    $('#serialNumberList').data("tComboBox").value("--Select--");
                    //                    $('#lblPartNumber').val('');
                    $('#conditionList').data("tComboBox").value("--Select--");
                    $('#symptomAreaList').data("tComboBox").value("--Select--");
                    $('#symptomCodeList').data("tComboBox").value("--Select--");
                    $('#diagnosisAreaList').data("tComboBox").value("--Select--");
                    $('#diagnosisCodeList').data("tComboBox").value("--Select--");
                    $('#resolutionList').data("tComboBox").value("--Select--");
                    $('#repairStageList').data("tComboBox").value("--Select--");
                    $('#technicianList').data("tComboBox").value("--Select--");
                    $('#descriptionTextBox').val('');
                    $('#commentsTextBox').val('');
                    $('#submit').text('Add');
                    $('#uniqueText').val('');
                    $('#submit').attr('disabled', false);
                },
                error: function (result) {
                    alert(result.responseText);
                }

            });

        }
        return false;
    });

    jQuery('#Clear').click(function () {
//        $('#serialNumberList').data("tComboBox").value("--Select--");
//        $('#lblPartNumber').text('');
        $('#conditionList').data("tComboBox").value("--Select--");
        $('#symptomAreaList').data("tComboBox").value("--Select--");
        $('#symptomCodeList').data("tComboBox").value("--Select--");
        $('#diagnosisAreaList').data("tComboBox").value("--Select--");
        $('#diagnosisCodeList').data("tComboBox").value("--Select--");
        $('#resolutionList').data("tComboBox").value("--Select--");
        $('#repairStageList').data("tComboBox").value("--Select--");
        $('#technicianList').data("tComboBox").value("--Select--");
        $('#descriptionTextBox').val('');
        $('#commentsTextBox').val('');
//        jQuery.ajax({
//            url: "/RepairLines/RepairLines",
//            type: 'POST'
//        });
//        return true;
    });


</script>